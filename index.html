<!DOCTYPE html>
<html>
<title>W3.CSS Template</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap-theme.min.css">
<!-- <link rel="stylesheet" type="text/css" href="./bootstrap-tagsinput.css" media="screen"/> -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script> -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.8.1/css/bootstrap-select.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.8.1/js/bootstrap-select.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>

<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<style>
  html {
  scroll-behavior: smooth;
}
body {font-family: "Times New Roman", Georgia, Serif;}
h1, h2, h3, h4, h5, h6 {
  font-family: "Playfair Display";
  letter-spacing: 5px;
}

#page_content{
  position: relative;
    /* min-height: 400px; */
}
a {
  color: inherit;
}

a:hover
{
     color:#00A0C6;
     text-decoration:none;
     cursor:pointer;
}

.loader {
  border: 16px solid #f3f3f3;
  border-radius: 50%;
  border-top: 16px solid blue;
  border-right: 16px solid green;
  border-bottom: 16px solid red;
  border-left: 16px solid pink;
  width: 120px;
  height: 120px;
  -webkit-animation: spin 2s linear infinite;
  animation: spin 2s linear infinite;

}

@-webkit-keyframes spin {
  0% { -webkit-transform: rotate(0deg); }
  100% { -webkit-transform: rotate(360deg); }
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#recipe_content{
    min-height: 400px;
    width: 100%;
    display: flex;
    justify-content: center;
}

#loader_content{
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

#search{
  left: 148px;
    top: 100px;
    position: relative;
    left: 10;
    right: 10px;
    font-size: 22px;
}
</style>
<body>


<!-- Header -->
<header class="w3-display-container w3-content w3-wide" style="position: relative; max-width:100%;min-width:500px;height: 100vh;width: 100vw;overflow: hidden;" id="home">
  <img class="w3-image" src="./background.jpg" alt="Hamburger Catering" width="100%" height="800">
    <div style="
    position: absolute;
    top: 23%;
    left: 68%;
    ">
    <h1 style="color: burlywood;opacity: 0.75;font-size: 520%;
    width: 700px;position: relative;
    right: 24%;">חיפוש מתכונים</h1>
    <div class="col-lg-12" style="position: absolute;
    top: 151px;">
      <select class="selectpicker" multiple data-live-search="true">
        <option>אבוקדו</option>
        <option>אבטיח</option>
        <option>אגוזי לוז</option>
        <option>אגוזים</option>
        <option>אוכמניות</option>
        <option>אוראו</option>
        <option>אורז</option>
        <option>אטריות</option>
        <option>אטריות אורז</option>
        <option>ארטישוק</option>
        <option>בזיליקום</option>
        <option>בננה</option>
        <option>בצל</option>
        <option>בצל ירוק</option>
        <option>בצק סוכר</option>
        <option>בצק עלים</option>
        <option>בצק פריך</option>
        <option>בצקניות</option>
        <option>ברוקולי</option>
        <option>בשר</option>
        <option>ג'לי</option>
        <option>גבינה</option>
        <option>גבינה בולגרית</option>
        <option>גבינה טבעונית</option>
        <option>גבינה צהובה</option>
        <option>גבינת שמנת</option>
        <option>גזר</option>
        <option>גרנולה</option>
        <option>דבש</option>
        <option>דגים</option>
        <option>דובדבנים</option>
        <option>דלורית</option>
        <option>דלעת</option>
        <option>דלעת ערמונים</option>
        <option>דפי אורז</option>
        <option>וופל</option>
        <option>וניל</option>
        <option>זיתים</option>
        <option>חומוס</option>
        <option>חלב מרוכז</option>
        <option>חלב סויה</option>
        <option>חלבה</option>
        <option>חמוציות</option>
        <option>חסה</option>
        <option>חציל</option>
        <option>טונה</option>
        <option>טופו</option>
        <option>טורטיה</option>
        <option>טורטליני</option>
        <option>טחינה</option>
        <option>טפיוקה</option>
        <option>טריאקי</option>
        <option>יוגורט</option>
        <option>יין לבן</option>
        <option>ירקות</option>
        <option>כרוב</option>
        <option>כרובית</option>
        <option>כרישה</option>
        <option>לוטוס</option>
        <option>לימון</option>
        <option>מוצרלה</option>
        <option>מייפל</option>
        <option>מיץ תפוזים</option>
        <option>מלון</option>
        <option>מנגו</option>
        <option>מנגולד</option>
        <option>מסקרפונה</option>
        <option>מצה</option>
        <option>מרנג</option>
        <option>מרציפן</option>
        <option>מרשמלו</option>
        <option>משמש</option>
        <option>נוגט</option>
        <option>נודלס</option>
        <option>נוטלה</option>
        <option>ניוקי</option>
        <option>סויה</option>
        <option>סוכר חום</option>
        <option>סילאן</option>
        <option>סלמון</option>
        <option>סלק</option>
        <option>עגבניות</option>
        <option>עדשים</option>
        <option>עוף</option>
        <option>עלי לזניה</option>
        <option>ענבים</option>
        <option>ערמונים</option>
        <option>עשבי תיבול</option>
        <option>פודינג</option>
        <option>פטרוזיליה</option>
        <option>פטריות</option>
        <option>פטריות מיובשות</option>
        <option>פיטאיה</option>
        <option>פירורי לחם</option>
        <option>פירות</option>
        <option>פירות יער</option>
        <option>פיתה</option>
        <option>פלפלים</option>
        <option>פסטה</option>
        <option>פסטו</option>
        <option>פסיפלורה</option>
        <option>פפריקה</option>
        <option>פקאנים</option>
        <option>פרג</option>
        <option>פרגית</option>
        <option>פרמזן</option>
        <option>פתי בר</option>
        <option>פתיתים</option>
        <option>צימוקים</option>
        <option>צנוברים</option>
        <option>קדאיף</option>
        <option>קוואקר</option>
        <option>קולורבי</option>
        <option>קוסקוס</option>
        <option>קוקוס</option>
        <option>קטשופ</option>
        <option>קינמון</option>
        <option>קישואים</option>
        <option>קישוט עוגות</option>
        <option>קמח חומוס</option>
        <option>קמח ללא גלוטן</option>
        <option>קמח מלא</option>
        <option>קמח מצה</option>
        <option>קפה</option>
        <option>קצפת</option>
        <option>קקאו</option>
        <option>קרם פטיסייר</option>
        <option>קרמל</option>
        <option>קרקרים</option>
        <option>קשיו</option>
        <option>רביולי</option>
        <option>רוטב עגבניות</option>
        <option>ריבה</option>
        <option>ריבת חלב</option>
        <option>ריקוטה</option>
        <option>רסק עגבניות</option>
        <option>שום</option>
        <option>שומשום</option>
        <option>שוקולד</option>
        <option>שוקולד לבן</option>
        <option>שוקולד צ'יפס</option>
        <option>שמיר</option>
        <option>שמנת לבישול</option>
        <option>שמנת מתוקה</option>
        <option>שמרים</option>
        <option>שעועית ירוקה</option>
        <option>שקדים</option>
        <option>תותים</option>
        <option>תירס</option>
        <option>תמרים</option>
        <option>תפוזים</option>
        <option>תפוזים סינים</option>
        <option>תפוחי אדמה</option>
        <option>תפוחי עץ</option>

      </select>
  </div>

  <a type="button" id="search" class="btn btn-success" href="#page_content" >חיפוש</a><br>
  <!-- <a type="button" id="search" class="btn btn-danger" href="javascript:resetSearch();" >אפס חיפוש</a> -->
    </div>
</header>


<!-- Page content -->
<div class="w3-content" id="page_content" style="max-width:1100px;direction: rtl;">

</div>

<!-- Footer -->
<footer class="w3-center w3-light-grey w3-padding-32">
    <p style="position: absolute;right: 55px" id="recipesNumber"></p>
  <p>Powered by <a href="" title="W3.CSS" target="_blank" class="w3-hover-text-green">Ofir & Hadas</a></p>
</footer>

</body>


<script>
function resetSearch(){
  $( "#page_content" ).empty();
  console.log($(".selectpicker")[0]);
  for (var i=0; i < $(".selectpicker")[0].options.length; i++) {
    $(".selectpicker")[0].options[i] = null;
    }
}
  const loader_html = `
<div id="recipe_content">
<div id="loader_content">
  <h1>מחפש מתכונים...</h1>
  <div class="loader"></div>
  </div>
</div>

  `;


  const dummyRecipe = `
<br><br>
  <hr>
  <h4>הוראות הכנה</h4>
  <ul>
    <li>משהו משהו</li>
    <li>משהו</li>
    <li>משהו</li>
  </ul>
  <br><br>
  `;
$( "#search" ).click(async function() {
  var ingredients = [];
        $.each($(".selectpicker option:selected"), function(){
          ingredients.push($(this).val());
        });
  if(ingredients.length==0){
    alert("You must choose at least one ingredient!");
    return;
  }
  $( "#page_content" ).empty();
  $( "#page_content" ).append( loader_html );
 const recipes = await setTimeout(()=>{
   const ingredients_json = JSON.stringify(ingredients);
  $.post('http://127.0.0.1:5000/recipes',ingredients_json, function (data){
    const recipiesHtmlElements = data.map(createRecipeHtmlElement);
    setRecipes(recipiesHtmlElements);
  });

}
  ,2000);;
});


function setRecipes(recipiesHtmlElements){
  $( "#page_content" ).empty();
  console.log(recipiesHtmlElements);
  const numberOfRecipes = recipiesHtmlElements.length;
  if(numberOfRecipes > 0) {
    $("#page_content").append(getHowManyRecipesFound(numberOfRecipes))
    $("#page_content").append(goToTop())
    recipiesHtmlElements.forEach(element =>
            $("#page_content").append(element));
  }else{
    $("#page_content").append(noResultFound())

  }
}

function goToTop(){
  return `<div><div style="position: fixed;
    /* top: 0; */
    left: 29px;
    bottom: 20px;"><a href="#home" style="font-size: 17px;
    color: blue;">חזור למעלה</a></div><div>`;
}

function noResultFound(){
  return `<div style="height: 300px;
    display: flex;
    align-items: center;
    justify-content: center;">
    <h1>לא נמצאו מתכונים... :(</h1>
    </div>`;
}

function getHowManyRecipesFound(numberOfRecipes){
  return `<br><h3 style="color: cadetblue">${numberOfRecipes} תוצאות: </h3>`
}

function createRecipeHtmlElement(recipe){
  const ingredients = recipe.ingredients;
  const instructions = recipe.instructions;
  const name = recipe.name;
  const url = recipe.url;
  return `
  <br><br>
  <hr>
  <h1><a href="${url}" target="_blank">${name}</a></h1>
  <h4>מצרכים</h4>
  <ul>
    ${ingredients.map(ingredient => `<li>${ingredient}</li>`).join("")}
  </ul>
  <h4>הוראות הכנה</h4>
  <ul>
    ${instructions.map(instruction => `<li>${instruction}</li>`).join("")}
  </ul>
  <br>
  `
  ;


}

 $.get('http://127.0.0.1:5000/resultsnumber', function (number){
     $("#recipesNumber").append(` האתר מכיל כ - ${number} מתכונים`)
  });

</script>
</html>
